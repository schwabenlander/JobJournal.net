@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication

@inject NavigationManager Navigation
@inject SignOutSessionStateManager SignOutManager

<nav
	class="navbar navbar-expand-lg fixed-top navbar-dark bg-blue shadow-sm"	aria-label="Main navigation">
	<div class="container-fluid">
		<a class="navbar-brand" href="#"	><i class="bi bi-book-half"></i> <strong>JobJournal</strong></a>
		<button
			class="navbar-toggler p-0 border-0"
			type="button"
			id="navbarSideCollapse"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<AuthorizeView>
			<Authorized>
				<div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
					<ul class="navbar-nav mx-auto mb-2 mb-lg-0">
						<li class="nav-item">
							<a class="nav-link active" aria-current="page" href="#">Overview</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Companies</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">Applications</a>
						</li>
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-bs-toggle="dropdown" aria-expanded="false">@context.User.Identity?.Name</a>
							<ul class="dropdown-menu" aria-labelledby="dropdown01">
								<li><a class="dropdown-item" href="#" @onclick="@BeginLogout" @onclick:preventDefault >Sign out</a></li>
							</ul>
						</li>
					</ul>

					<form class="d-flex">
						<input
							class="form-control me-2"
							type="search"
							placeholder="Search"
							aria-label="Search"
						/>
						<button class="btn btn-outline-white" type="submit">
							<i class="bi bi-search"></i>
						</button>
					</form>
				</div>
			</Authorized>
			<NotAuthorized>
				<div class="navbar-collapse offcanvas-collapse" id="navbarsExampleDefault">
					<ul class="navbar-nav mx-auto mb-2 mb-lg-0">
						<li>
							<a href="authentication/login" class="nav-link">Sign in</a>
						</li>
					</ul>
				</div>
			</NotAuthorized>
		</AuthorizeView>
	</div>
</nav>

@code{
    private async Task BeginLogout(MouseEventArgs args)
    {
        await SignOutManager.SetSignOutState();
        Navigation.NavigateTo("authentication/logout");
    }
}
